<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"  xml:lang="en-gb" lang="en-gb" dir="ltr" >
<head>
  <base href="https://blog-archive.pavlakis.info/php/9-choose-your-default-action-in-zend-framework" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="keywords" content="php, zend framework, actions, overloading" />
  <meta name="author" content="Antonios Pavlakis" />
  <meta name="generator" content="Joomla! - Open Source Content Management" />
  <title>Choose your default action in Zend Framework</title>
  <link href="/templates/beez_20/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="/templates/system/css/system.css" type="text/css" />
  <link rel="stylesheet" href="/templates/beez_20/css/position.css" type="text/css" media="screen,projection"  />
  <link rel="stylesheet" href="/templates/beez_20/css/layout.css" type="text/css" media="screen,projection"  />
  <link rel="stylesheet" href="/templates/beez_20/css/print.css" type="text/css" media="print"  />
  <link rel="stylesheet" href="/templates/beez_20/css/general.css" type="text/css" />
  <link rel="stylesheet" href="/templates/beez_20/css/nature.css" type="text/css" />
  <script src="/media/system/js/mootools-core.js" type="text/javascript"></script>
  <script src="/media/system/js/core.js" type="text/javascript"></script>
  <script src="/media/system/js/caption.js" type="text/javascript"></script>
  <script src="/media/system/js/mootools-more.js" type="text/javascript"></script>
  <script src="/templates/beez_20/javascript/md_stylechanger.js" type="text/javascript"></script>
  <script src="/templates/beez_20/javascript/hide.js" type="text/javascript"></script>
  <script type="text/javascript">
window.addEvent('load', function() {
				new JCaption('img.caption');
			});
  </script>


<!--[if lte IE 6]>
<link href="/templates/beez_20/css/ieonly.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if IE 7]>
<link href="/templates/beez_20/css/ie7only.css" rel="stylesheet" type="text/css" />
<![endif]-->

<script type="text/javascript">
	var big ='72%';
	var small='53%';
	var altopen='is open';
	var altclose='is closed';
	var bildauf='/templates/beez_20/images/plus.png';
	var bildzu='/templates/beez_20/images/minus.png';
	var rightopen='Open info';
	var rightclose='Close info';
	var fontSizeTitle='Font size';
	var bigger='Bigger';
	var reset='Reset';
	var smaller='Smaller';
	var biggerTitle='Increase size';
	var resetTitle='Revert styles to default';
	var smallerTitle='Decrease size';
</script>

</head>

<body>

<div id="all">
        <div id="back">
                <div id="header">
                                <div class="logoheader">
                                        <h1 id="logo">

                                                                                                                        Adventures in Lifelong Development                                                                                <span class="header1">
                                        /pavlakis                                        </span></h1>
                                </div><!-- end logoheader -->
                                        <ul class="skiplinks">
                                                <li><a href="#main" class="u2">Skip to content</a></li>
                                                <li><a href="#nav" class="u2">Jump to main navigation and login</a></li>
                                                                                    </ul>
                                        <h2 class="unseen">Nav view search</h2>
                                        <h3 class="unseen">Navigation</h3>
                                        
<ul class="menu">
<li class="item-101"><a href="/" >Home</a></li><li class="item-102"><a href="/about-antonios-pavlakis" >About Me</a></li><li class="item-103 current active"><a href="/php" >PHP</a></li><li class="item-121"><a href="https://github.com/pavlakis" >GitHub</a></li></ul>

                                        <div id="line">
                                        <div id="fontsize"></div>
                                        <h3 class="unseen">Search</h3>
                                        <form action="/php" method="post">
	<div class="search">
		<label for="mod-search-searchword">Search...</label><input name="searchword" id="mod-search-searchword" maxlength="20"  class="inputbox" type="text" size="20" value="Search..."  onblur="if (this.value=='') this.value='Search...';" onfocus="if (this.value=='Search...') this.value='';" />	<input type="hidden" name="task" value="search" />
	<input type="hidden" name="option" value="com_search" />
	<input type="hidden" name="Itemid" value="103" />
	</div>
</form>

                                        </div> <!-- end line -->


                        </div><!-- end header -->
                        <div id="contentarea">
                                        <div id="breadcrumbs">

                                                        

                                        </div>

                                        
                                        <div id="wrapper2" class="shownocolumns">

                                                <div id="main">

                                                
                                                        
<div id="system-message-container">
</div>
                                                        <div class="item-page">

	<h2>
			<a href="/php/9-choose-your-default-action-in-zend-framework">
		Choose your default action in Zend Framework</a>
		</h2>

	<ul class="actions">
						<li class="print-icon">
			<a href="/php/9-choose-your-default-action-in-zend-framework?tmpl=component&amp;print=1&amp;layout=default&amp;page=" title="Print" onclick="window.open(this.href,'win2','status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no'); return false;" rel="nofollow"><img src="/media/system/images/printButton.png" alt="Print"  /></a>			</li>
		
					<li class="email-icon">
			<a href="/component/mailto/?tmpl=component&amp;template=beez_20&amp;link=c7f8a8e3e9911089a8df832a9c2057c0002529c6" title="Email" onclick="window.open(this.href,'win2','width=400,height=350,menubar=yes,resizable=yes'); return false;"><img src="/media/system/images/emailButton.png" alt="Email"  /></a>			</li>
		
		
	
	</ul>




	<dl class="article-info">
	<dt class="article-info-term">Details</dt>
	<dd class="create">
	Created on Tuesday, 29 March 2011 11:41	</dd>
	</dl>



<p>
  I have an action that I want to pass parameters to. But, I also want to be able to use the other actions in that controller. <br />
Only if those actions are not found, I want to default to a specific action.
<p>
 
<p>  
The example I am going to use here is Subscribe. 
I want my users to be able to see a different subscription page depending on the type of subscription. So I have three main use cases:
</p>

<ul>
  <li>Subscribe using a promotional code</li>
  <li>Subscribe for the basic version</li>
  <li>Subscribe for the full version</li>
</ul>
  
<p>
  To do any of the above, I want to use the index Action. However, in the same controller I also have actions for:<br />
</p>

<ul>
  <li>confirm</li>
  <li>activate</li>
  <li>unsubscribe</li>
</ul>
  
<p>
In order to be able to identify the type of subscription, I will need to pass a parameter for that. Also, if the user has a promotional code, I want that as a parameter also.
  </p>
   
<p>  
This is easily accomplished with a router.
</p>
<pre class="prettyprint lang-php">
  $route = new Zend_Controller_Router_Route(
   'subscribe/:action/:type/:code',
   array(
    'controller' => 'subscribe',
    'action'     => 'index',
                                    'type'          => 'c',
                                    'code'          => ''
   )
  );
</pre>

<h3>The Problem</h3>

<p>
  At this point, I can quite happily pass this url: 
  http://mysite.com/subscribe/index/thistype/thatcode 
</p>

<p>
But, I don’t really want index to be in the url. However, if I don’t pass it, I will most likely get a 404 as thistype is not an action.
</p>
  
<h3>A Solution</h3>

<p>
The way I went about with this, after spending hours trying to figure it out by myself and Google... I asked at the channel (#zftalk in freenode). The guys suggested overloading. It is funny what one keyword can do, huh? Make a search for __call and there is documentation!
  <a href="http://framework.zend.com/manual/en/zend.controller.action.html">http://framework.zend.com/manual/en/zend.controller.action.html </a> 
</p>
  
  <p>So let’s start with that. </p>

<pre class="prettyprint lang-php">
        public function __call($method, $args){
  // only interested if an action is called
            if('Action' == substr($method, -6)){
  // this is what it would normally happen
$this->render();
            }
        }


</pre>

<p>
The code above, has not helped me in anyway. I’ve overloaded my controller but still rendering the action as it would happen normally anyway.
</p>
  <p>
What I actually want to do, though, is to check if that action exists. All an action is, is a method.
  </p>
<pre class="prettyprint lang-php">
  if(method_exists($this, $method)){
                    $this->render();
                }
</pre>

<p>
So far so good. I can identify if a valid action is being passed, and render it if it is.<br />
If not, there are three things I am interested in: <br />
<ol>
<li>use index Action</li>
<li>pass the type parameter</li>
<li>pass the code  parameter</li>
</ol>
</p>

<p>
In my router I have set my route as: subscribe/:action/:type/:code 
So, if the first parameter is not a valid action, I will assume that is type - in which case I will need the following: 
</p>
<pre class="prettyprint lang-php">

                    $params['type'] = $this->getRequest()->getParam('action');
                    $params['code'] = $this->getRequest()->getParam('type');

</pre>

<p>
Now I have all the information I need, all is left is to pass it to the relevant action:
</p>

<pre class="prettyprint lang-php">
$this->_forward('index', 'subscribe', 'default', $params);
</pre>

<p>For completeness, the final function is:</p>

<pre class="prettyprint lang-php">
       public function __call($method, $args){
            if('Action' == substr($method, -6)){
                if(method_exists($this, $method)){
                    $this->render();
                }else{
                    
                    $params['type'] = $this->getRequest()->getParam('action');
                    $params['code'] = $this->getRequest()->getParam('type');

                    $this->_forward('index', 'subscribe', 'default', $params);
                }
            }
        }


</pre>

<p>Mission accomplished: mysite.com/subscribe/thistype/thatcode will now load the index Action.</p>

				<ul class="pagenav">
					<li class="pagenav-prev">
						<a href="/php/10-zf2-some-new-features-in-a-nutshell" rel="prev">&lt; Prev</a>
					</li>
					<li class="pagenav-next">
						<a href="/php/8-moving-a-website-to-a-new-provider" rel="next">Next &gt;</a>
					</li>
				</ul>
	
</div>


                                                </div><!-- end main -->

                                        </div><!-- end wrapper -->

                                
                        
                                <div class="wrap"></div>

                                </div> <!-- end contentarea -->

                        </div><!-- back -->

                </div><!-- all -->

                <div id="footer-outer">
                        
                        <div id="footer-sub">


                                <div id="footer">

                                        
                                        <p>
                                                Powered by <a href="http://www.joomla.org/">Joomla!&#174;</a>
                                        </p>


                                </div><!-- end footer -->

                        </div>

                </div>
				
        <div id="fb-root"></div>
<script>
window.fbAsyncInit = function() { FB.init({appId: '485228941509888', status: true, cookie: true, xfbml: true}); };
(function() { var e = document.createElement('script');
e.type = 'text/javascript';
e.src = document.location.protocol + '//connect.facebook.net/en_GB/all.js';
e.async = true;
document.getElementById('fb-root').appendChild(e);
}());
</script></body>
</html>
