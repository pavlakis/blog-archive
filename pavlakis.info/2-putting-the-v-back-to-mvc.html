<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"  xml:lang="en-gb" lang="en-gb" dir="ltr" >
<head>
  <base href="https://blog-archive.pavlakis.info/php/2-putting-the-v-back-to-mvc" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Super User" />
  <meta name="generator" content="Joomla! - Open Source Content Management" />
  <title>Putting the 'V' back to MVC</title>
  <link href="/templates/beez_20/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="/templates/system/css/system.css" type="text/css" />
  <link rel="stylesheet" href="/templates/beez_20/css/position.css" type="text/css" media="screen,projection"  />
  <link rel="stylesheet" href="/templates/beez_20/css/layout.css" type="text/css" media="screen,projection"  />
  <link rel="stylesheet" href="/templates/beez_20/css/print.css" type="text/css" media="print"  />
  <link rel="stylesheet" href="/templates/beez_20/css/general.css" type="text/css" />
  <link rel="stylesheet" href="/templates/beez_20/css/nature.css" type="text/css" />
  <script src="/media/system/js/mootools-core.js" type="text/javascript"></script>
  <script src="/media/system/js/core.js" type="text/javascript"></script>
  <script src="/media/system/js/caption.js" type="text/javascript"></script>
  <script src="/media/system/js/mootools-more.js" type="text/javascript"></script>
  <script src="/templates/beez_20/javascript/md_stylechanger.js" type="text/javascript"></script>
  <script src="/templates/beez_20/javascript/hide.js" type="text/javascript"></script>
  <script type="text/javascript">
window.addEvent('load', function() {
				new JCaption('img.caption');
			});
  </script>


<!--[if lte IE 6]>
<link href="/templates/beez_20/css/ieonly.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if IE 7]>
<link href="/templates/beez_20/css/ie7only.css" rel="stylesheet" type="text/css" />
<![endif]-->

<script type="text/javascript">
	var big ='72%';
	var small='53%';
	var altopen='is open';
	var altclose='is closed';
	var bildauf='/templates/beez_20/images/plus.png';
	var bildzu='/templates/beez_20/images/minus.png';
	var rightopen='Open info';
	var rightclose='Close info';
	var fontSizeTitle='Font size';
	var bigger='Bigger';
	var reset='Reset';
	var smaller='Smaller';
	var biggerTitle='Increase size';
	var resetTitle='Revert styles to default';
	var smallerTitle='Decrease size';
</script>

</head>

<body>

<div id="all">
        <div id="back">
                <div id="header">
                                <div class="logoheader">
                                        <h1 id="logo">

                                                                                                                        Adventures in Lifelong Development                                                                                <span class="header1">
                                        /pavlakis                                        </span></h1>
                                </div><!-- end logoheader -->
                                        <ul class="skiplinks">
                                                <li><a href="#main" class="u2">Skip to content</a></li>
                                                <li><a href="#nav" class="u2">Jump to main navigation and login</a></li>
                                                                                    </ul>
                                        <h2 class="unseen">Nav view search</h2>
                                        <h3 class="unseen">Navigation</h3>
                                        
<ul class="menu">
<li class="item-101"><a href="/" >Home</a></li><li class="item-102"><a href="/about-antonios-pavlakis" >About Me</a></li><li class="item-103 current active"><a href="/php" >PHP</a></li><li class="item-121"><a href="https://github.com/pavlakis" >GitHub</a></li></ul>

                                        <div id="line">
                                        <div id="fontsize"></div>
                                        <h3 class="unseen">Search</h3>
                                        <form action="/php" method="post">
	<div class="search">
		<label for="mod-search-searchword">Search...</label><input name="searchword" id="mod-search-searchword" maxlength="20"  class="inputbox" type="text" size="20" value="Search..."  onblur="if (this.value=='') this.value='Search...';" onfocus="if (this.value=='Search...') this.value='';" />	<input type="hidden" name="task" value="search" />
	<input type="hidden" name="option" value="com_search" />
	<input type="hidden" name="Itemid" value="103" />
	</div>
</form>

                                        </div> <!-- end line -->


                        </div><!-- end header -->
                        <div id="contentarea">
                                        <div id="breadcrumbs">

                                                        

                                        </div>

                                        
                                        <div id="wrapper2" class="shownocolumns">

                                                <div id="main">

                                                
                                                        
<div id="system-message-container">
</div>
                                                        <div class="item-page">

	<h2>
			<a href="/php/2-putting-the-v-back-to-mvc">
		Putting the 'V' back to MVC</a>
		</h2>

	<ul class="actions">
						<li class="print-icon">
			<a href="/php/2-putting-the-v-back-to-mvc?tmpl=component&amp;print=1&amp;layout=default&amp;page=" title="Print" onclick="window.open(this.href,'win2','status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no'); return false;" rel="nofollow"><img src="/media/system/images/printButton.png" alt="Print"  /></a>			</li>
		
					<li class="email-icon">
			<a href="/component/mailto/?tmpl=component&amp;template=beez_20&amp;link=169c08d6952e6a758d65725e9458728f4c698af2" title="Email" onclick="window.open(this.href,'win2','width=400,height=350,menubar=yes,resizable=yes'); return false;"><img src="/media/system/images/emailButton.png" alt="Email"  /></a>			</li>
		
		
	
	</ul>




	<dl class="article-info">
	<dt class="article-info-term">Details</dt>
	<dd class="create">
	Created on Friday, 17 December 2010 22:19	</dd>
	</dl>



<p>I have been using Zend Framework (ZF) quite heavily in projects with lots of XHR requests aka ajax.   I have recently discovered of some good practices, which I will show below.  When having an action in your controller, you can quite as easily grab the info from your model, echo it out on screen and just exit.  However, ZF provides a much nicer way of doing so. If you have multiple formats, eg json, xml, html, you could use <a href="http://framework.zend.com/manual/en/zend.controller.actionhelpers.html">ContextSwitch</a> As I'm only using text/html and json, I use it in the following way:  When I want to output text/html, I use inside my action:</p>
<pre class="prettyprint">// for reference, name controller to MyxhrController<br />public function xhrAction()<br />{<br />// don't actually need the layout, just the text I am about to pass  <br />$this-&gt;_helper-&gt;layout-&gt;disableLayout();<br />$this-&gt;view-&gt;stuff = '&lt;h1&gt;Going deeper underground...&lt;/h1&gt;';<br />}<br /></pre>
<p> </p>
 
<p> </p>
<p>In my view script xhr.phtml I just need to output the variable</p>
<pre class="prettyprint lang-php">  echo $this-&gt;stuff;<br /></pre>
<p>Now, if you look at: http://localhost/myxhr/xhr  You should see a blank page with only the text we are passing.  As I want my users to only see that when I am passing it using an xhr, I will add the following:</p>
<pre class="prettyprint lang-php">public function xhrAction()<br />{<br />		if(!$this-&gt;getRequest() -&gt;isXmlHttpRequest()){<br />			$this-&gt;view-&gt;stuff = 'Put here something meaningful for your users...';<br />                        // if loading a full page, add a title<br />                        $this-&gt;view-&gt;headTitle('A meaningful title goes here...');<br />		}else{<br />			$this-&gt;_helper-&gt;layout-&gt;disableLayout();<br />			$this-&gt;view-&gt;stuff = '&lt;h1&gt;Going deeper underground...&lt;/h1&gt;';<br />		}<br />}<br /><br /></pre>
<p>So, with the above code, we have nicely dealt with an xhr request returning text/html.  Now, let's see what we can do if we want to pass a json string.</p>
<pre class="prettyprint lang-php">public function jsonAction()<br />{<br />   $jsonStuff  = array('test1' =&gt; 'my test 1', 'test2' =&gt; 'my test 2');<br />	<br />   // no need to disable layout	<br />   $this-&gt;_helper-&gt;json($jsonStuff);<br />}<br /></pre>
<p>We don't need to disable the layout, that is one of the things that the json helper is doing. The other things it does:</p>
<ul>
<li>Disables the view renderer</li>
<li>Encodes array to json</li>
<li>Sets response header to application/json</li>
</ul>
<p>For more info, look at the nicely written zf documentation: <a href="http://framework.zend.com/manual/en/zend.controller.actionhelpers.html#zend.controller.actionhelpers.json">JSON Action Helper</a></p>
				<ul class="pagenav">
					<li class="pagenav-prev">
						<a href="/php/6-zend-dojo-cdn-with-ssl" rel="prev">&lt; Prev</a>
					</li>
					<li class="pagenav-next">
						<a href="/php/5-zend-framework-with-dojo-security-update" rel="next">Next &gt;</a>
					</li>
				</ul>
	
</div>


                                                </div><!-- end main -->

                                        </div><!-- end wrapper -->

                                
                        
                                <div class="wrap"></div>

                                </div> <!-- end contentarea -->

                        </div><!-- back -->

                </div><!-- all -->

                <div id="footer-outer">
                        
                        <div id="footer-sub">


                                <div id="footer">

                                        
                                        <p>
                                                Powered by <a href="http://www.joomla.org/">Joomla!&#174;</a>
                                        </p>


                                </div><!-- end footer -->

                        </div>

                </div>
				
        <div id="fb-root"></div>
<script>
window.fbAsyncInit = function() { FB.init({appId: '485228941509888', status: true, cookie: true, xfbml: true}); };
(function() { var e = document.createElement('script');
e.type = 'text/javascript';
e.src = document.location.protocol + '//connect.facebook.net/en_GB/all.js';
e.async = true;
document.getElementById('fb-root').appendChild(e);
}());
</script></body>
</html>
